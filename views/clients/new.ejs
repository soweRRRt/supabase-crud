<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Client</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script>
    function formatPhoneNumber(input) {
      // Удаляем все нецифровые символы кроме плюса
      let value = input.value.replace(/[^\d+]/g, '');
      
      // Если нет плюса в начале - добавляем
      if (!value.startsWith('+')) {
        value = '+' + value.replace(/^\+/, '');
      }
      
      // Ограничиваем длину (максимум 15 символов включая плюс)
      if (value.length > 15) {
        value = value.substring(0, 15);
      }
      
      input.value = value;
    }

    function validatePhoneNumber(input) {
      const phoneRegex = /^\+\d{1,14}$/;
      const isValid = phoneRegex.test(input.value);
      
      if (!isValid && input.value !== '') {
        input.setCustomValidity('Номер телефона должен быть в формате +XXXXXXXXXXX (только цифры после +)');
      } else {
        input.setCustomValidity('');
      }
    }

    function validateForm(event) {
      const phoneInput = document.querySelector('input[name="phone_number"]');
      validatePhoneNumber(phoneInput);
      
      if (!phoneInput.validity.valid) {
        event.preventDefault();
        return false;
      }
      return true;
    }
  </script>
</head>
<body class="container py-5">
  <h1 class="mb-4">Новый клиент</h1>
  <form action="/clients" method="POST" class="mb-3" onsubmit="return validateForm(event)">
    <div class="mb-3">
      <label class="form-label">ФИО:</label>
      <input class="form-control" type="text" name="full_name" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Номер телефона:</label>
      <input 
        class="form-control" 
        type="text" 
        name="phone_number" 
        placeholder="+79991234567"
        oninput="formatPhoneNumber(this)"
        onblur="validatePhoneNumber(this)"
        pattern="^\+\d{1,14}$"
        title="Номер телефона должен быть в формате +XXXXXXXXXXX (только цифры после +)"
        required
      >
      <div class="form-text">Формат: +XXXXXXXXXXX (только цифры после знака +)</div>
    </div>
    <div class="mb-3">
      <label class="form-label">Статус:</label>
      <select class="form-select" name="status_id" required>
        <option value="">Выбор статуса</option>
        <% statuses.forEach(s => { %>
          <option value="<%= s.id %>"><%= s.name %></option>
        <% }) %>
      </select>
    </div>
    <button class="btn btn-success" type="submit">Создать</button>
    <a class="btn btn-secondary" href="/clients">Отмена</a>
  </form>
</body>
</html>